# 🏗️ Taste Tree System Architecture

> **Document Version**: 1.0.0
> **Last Updated**: 2026-02-05

## 1. System Overview (Vision Internalization)

**Taste Tree**는 단순한 취향 기록 앱이 아닌, **'다정한 기술 생태계(Gentle Tech Ecosystem)'**를 지향하는 디지털 정원입니다.
우리는 유저의 대화를 단순 텍스트로 보지 않고, **'디지털 인류학(Digital Anthropology)'**적 가치를 지닌 '욕망의 아카이브'로 정의합니다.

이 프로젝트의 핵심은 **Data Sovereignty(데이터 주권)**의 실현입니다. 유저의 사유와 취향은 **Answer_Asset**이라는 독립적인 객체로 관리되며, 시스템은 이 자산의 가치를 $trustScore 로직을 통해 증명하고 보상합니다.

### 🌟 Key Technical Features
- **Gentle Tech Persona**: "상냥한 정원사" 페르소나 (Jimini)가 유저의 대화를 이끌어냅니다.
- **Answer_Asset Protocol**: 대화의 깊이와 진정성을 정량화하여 자산으로 변환하는 로직.
- **Living Pixel Garden**: 사용자의 감정과 성장에 동기화된 파스텔 톤 픽셀 아트 세계.
- **Trust Score Algorithm**: 답변의 인류학적 가치를 평가하는 독자적인 스코어링 시스템.

---

## 2. System Architecture

### 2.1 Tech Stack
| Category | Technology | Purpose |
|----------|------------|---------|
| **Frontend** | Next.js 15 (App Router) | Server-Side Rendering & Client interaction |
| **Styling** | Tailwind CSS | Pixel Art aesthetic implementation |
| **Visuals** | HTML5 Canvas API | Procedural generation of pixel art trees & weather |
| **AI Engine** | Google Gemini (1.5-flash) | NLU, Persona Management, Sentiment Analysis |
| **Sound** | Web Audio API | Real-time 8-bit sound synthesis (Oscillator) |
| **State** | React Hooks | Local state & Interaction management |

### 2.2 Data Flow Diagram (Mermaid)

```mermaid
graph TD
    User[User Input] -->|POST /api/chat| NextAPI[Next.js API Route]
    NextAPI -->|Context Injection| Gemini[Google Gemini API]
    
    subgraph AI Engine
        Gemini -->|Analysis| Sentiment[Sentiment Analysis]
        Gemini -->|Analysis| Trust[Trust Score Calculation]
        Gemini -->|Analysis| Env[Environment & Search Logic]
    end
    
    Gemini -->|JSON Response| Frontend[Client (CreatePage)]
    
    subgraph Frontend Logic
        Frontend -->|Render| Typewriter[Typewriter Effect]
        Frontend -->|Update State| Garden[Garden Canvas]
        Frontend -->|Synthesize| Audio[Sound Manager]
    end
    
    Frontend -->|Completion| Asset[Answer_Asset Creation]
    Asset -->|Store| LocalStorage[Local/Wallet Storage]
```

---

## 3. Core Algorithms

### 3.1 Trust Score Evaluation (신뢰도 산정)
AI는 사용자의 답변을 단순 텍스트가 아닌 '진정성' 기준으로 평가합니다.

- **Depth Factor (40%)**: 답변의 구체성 및 길이. ("좋았어" vs "그날의 햇살과 냄새가 기억나")
- **Context Relevance (30%)**: 질문 의도와의 일치 여부.
- **Consistency (30%)**: 이전 대화 맥락과의 논리적 연결성.

`Route.ts` 내의 시스템 프롬프트가 이를 0.0~1.0 사이의 Float 값으로 산출하며, 이는 최종 TASTE 토큰 보상 수량 결정의 기준이 됩니다.

### 3.2 Dynamic Environment Rendering
사용자의 감정 상태(Sentiment)는 시각적 날씨와 시간대로 직결됩니다.

| **Sorrow / Calm** | Rainy | Night | Blue/Deep Green |

### 3.3 Taste Pin Logic (Global Connectivity)
**Taste Pin**은 Answer_Asset의 Vector Similarity를 기반으로 작동하는 시각적 연결 프로토콜입니다.

1.  **Pin Drop**: Stage 5(Bloom) 도달 시, 유저의 IP(혹은 설정된 도시) 위치에 8-bit Pin이 생성됩니다.
2.  **Similarity Search**: Vector DB에서 코사인 유사도(Cosine Similarity) 0.85 이상의 Answer_Asset을 보유한 다른 유저를 스캔합니다.
3.  **Resonance Effect**:
    -   유사 유저(Taste Twin)의 핀이 지도 상에서 은은하게 점멸(Pulse Animation).
    -   연결 시 "안개가 걷히는(Fog reveal)" 연출과 함께 따뜻한 차임벨 사운드(Chime) 재생.

---

## 4. Future Scalability (Roadmap)
현재 MVP 단계는 LocalStorage 및 Mock API를 사용하고 있으나, 향후 **Vibe Labs**와의 협업을 통해 다음 단계로 확장 예정입니다.

1. **RAG (Retrieval-Augmented Generation)**: Vector DB 도입을 통해 사용자의 과거 취향 데이터를 장기 기억으로 저장.
2. **On-Chain Integration**: Trust Score를 기반으로 Soulbound Token (SBT) 발행.
3. **Immersive Audio**: Web Audio API를 넘어선 Spatial Audio (공간 음향) 적용.

---
*Generated by Antigravity Team*
